<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>login</title>
	<style>
		html {
			font-family: system-ui;
			height: 100vh;
			margin: auto;
		}
		dialog {
			display: table;
			align-items: center;
			border: none;
			border-radius: 5px;
			background: lightgray;
		}
		label {
			display: table-row;
		}
		input {
			float: right;
		}
		input[type="submit"] {
			margin-top: 10px;
		}
	</style>
	<script>
		function onformsubmission (event) {
			event.preventDefault()
			console.log('form submit')
			const form_data = new FormData(event.target)
			const form_obj = {}
			form_obj[name] = form_data['name']
			console.log('form', form_obj)

			fetch(window.location.href, {
				method: 'post',
				headers: {
					'content-type': 'application/json'
				},
				body: JSON.stringify(form_obj)
			})
			.then(response => response.json())
				.then(data => console.log(data))

		}
		function onnameinputblur (event) {
			if (!event.target.value) {
				console.log('empty username field')
			}
			else {
			console.log(event.target.value)
			fetch ('/api/'+event.target.value, {
				method: "get",
				headers: {
					"content-type": "application/json"
				}
			}).then(res => res.json())
				.then((data) => {
					console.log(data.name)
					if (data.name === true) {
						document.body.querySelector("input[type='text']").setAttribute('disabled', 'true')
						document.body.querySelector("code").textContent = ""
						document.body.querySelector("input[type='text']").style.color = "lightgreen"
					}
					else {
						document.body.querySelector("input[type='text']").removeAttribute('disabled')
						document.body.querySelector("input[type='text']").style.color = "orange"
						document.body.querySelector("input[type='text']").focus()
						document.body.querySelector("code").textContent = "(user does not exist)"
					}
				})
			}
		}
		window.addEventListener('DOMContentLoaded', (event) => {
			document.body.querySelector("form").addEventListener('submit', onformsubmission)
			document.body.querySelector("input[type='text']").addEventListener('blur', onnameinputblur)
		})
	</script>
</head>
<body>
	<nav>
		<a href="..">..</a>
		<a href="/register">register</a>
	</nav>
	<dialog open>
		<form action="/login" method="post" enctype="text">
			<legend>login</legend>
			<label for="username"> <input type="text" placeholder="username" name="username" /> </label>
			<label for="password"> <input type="password" placeholder="password" name="password" /> </label>
			<input type="submit"/>
		</form>
		<code id="response-info"></code>
	</dialog>
</body>
</html>
